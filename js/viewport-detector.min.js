!function(a){function b(b,c){this.$el=a(b),this.prev=null,this.activeClass=c.activeClass,this.selector=c.selector,this.activeSelector=this.selector+"."+this.activeClass,this.cardHeight=+this.$el.find(this.selector).filter(":first-child").height(),this.sensitivity=c.sensitivity,this.threshold=this.cardHeight*this.sensitivity,this.windowHeight=window.innerHeight||document.documentElement.clientHeight,this.callback={},this.callback.cardChange=c.callback.cardChange,this.callback.topCard=c.callback.topCard,this.callback.bottomCard=c.callback.bottomCard,this.$el.addClass("viewport-detector-enabled")}b.prototype.resetAll=function(){this.$el.find(this.activeSelector).removeClass(this.activeClass)},b.prototype.activateFirst=function(){var a=this.$el.find(this.selector).filter(":first-child"),b=this.$el.find(this.activeSelector);this.activate(a,b)&&this.callback.cardChange(0,a[0],this.prev)},b.prototype.activateLast=function(){var a=this.$el.find(this.selector).filter(":last-child"),b=this.$el.find(this.activeSelector),c=this.$el.find(this.selector).length;this.activate(a,b)&&this.callback.cardChange(c,a[0],this.prev)},b.prototype.activateCard=function(b,c){var d=this.$el.find(this.activeSelector);this.activate(a(c),d)&&this.callback.cardChange(b,c,this.prev)},b.prototype.activate=function(a,b){return a.is(b)?!1:(this.prev=b.length?b[0]:null,this.resetAll(),a.addClass(this.activeClass),!0)},b.prototype.isInViewport=function(b){var c=a(b),d=a(window).scrollTop(),e=d+a(window).height(),f=c.offset().top,g=f+c.height();return d<f+this.threshold&&e>g-this.threshold},b.prototype.listen=function(){var b=this,c=0;if(a(window).scrollTop()<=0?b.activateFirst():b.windowHeight+a(window).scrollTop()>=a(document).height()?b.activateLast():b.isInViewport(b.$el.find(b.activeSelector).get(0))||b.$el.find(b.selector).each(function(d,e){return!b.isInViewport(e)||a(e).hasClass(b.activeClass)||c?void 0:(b.activateCard(d,e),c++,!1)}),b.$el.find(b.activeSelector).length>1){var d=b.$el.find(b.selector).filter(":first");b.resetAll(),d.addClass(b.activeClass)}},a.fn.viewportDetector=function(c){var d=a.extend({selector:"li",sensitivity:.2,activeClass:"active-card",callback:{cardChange:null}},c);return this.each(function(){var c=new b(this,d);a(window).on("DOMContentLoaded load resize scroll",c.listen.bind(c))})}}(jQuery);