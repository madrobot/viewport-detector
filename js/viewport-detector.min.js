!function(a){function b(b,c){this.$el=a(b),this.prev=null,this.activeClass=c.activeClass,this.selector=c.selector,this.activeSelector=this.selector+"."+this.activeClass,this.cardHeight=+this.$el.find(this.selector).filter(":first").height(),this.sensitivity=c.sensitivity,this.threshold=this.cardHeight*this.sensitivity,this.windowHeight=window.innerHeight||document.documentElement.clientHeight,this.callback={},this.callback.beforeChange=c.callback.beforeChange,this.callback.afterChange=c.callback.afterChange,this.$el.addClass("viewport-detector-enabled")}b.prototype.resetAll=function(){this.$el.find(this.activeSelector).removeClass(this.activeClass)},b.prototype.activateFirst=function(){var a=this.$el.find(this.selector).filter(":first"),b=this.$el.find(this.activeSelector);this.activate(a,b)&&this.callback.afterChange(0,a[0],this.prev)},b.prototype.activateLast=function(){var a=this.$el.find(this.selector).filter(":last"),b=this.$el.find(this.activeSelector),c=this.$el.find(this.selector).length;this.activate(a,b)&&this.callback.afterChange(c-1,a[0],this.prev)},b.prototype.activateCard=function(b,c){var d=this.$el.find(this.activeSelector);this.activate(a(c),d)&&this.callback.afterChange(b,c,this.prev)},b.prototype.activate=function(a,b){if(!a.is(b)){var c=this.$el.find(this.selector).index(a);this.prev=b.length?b[0]:null;var d=this.callback.beforeChange(c,a,this.prev);if(d!==!1)return this.resetAll(),a.addClass(this.activeClass),!0}return!1},b.prototype.isInViewport=function(b){try{var c=a(b),d=a(window).scrollTop(),e=d+a(window).height(),f=c.offset().top,g=f+c.height();return d<f+this.threshold&&e>g-this.threshold}catch(h){return!1}},b.prototype.listen=function(){var b=this,c=0;if(a(window).scrollTop()<=0?b.activateFirst():b.windowHeight+a(window).scrollTop()>=a(document).height()?b.activateLast():b.isInViewport(b.$el.find(b.activeSelector).get(0))||b.$el.find(b.selector).each(function(d,e){return!b.isInViewport(e)||a(e).hasClass(b.activeClass)||c?void 0:(b.activateCard(d,e),c++,!1)}),b.$el.find(b.activeSelector).length>1){var d=b.$el.find(b.selector).filter(":first");b.resetAll(),d.addClass(b.activeClass)}},a.fn.viewportDetector=function(c){var d=a.extend({selector:"li",sensitivity:.2,activeClass:"active-card",callback:{beforeChange:null,afterChange:null}},c);return this.each(function(){var c=new b(this,d);a(window).on("DOMContentLoaded load resize scroll",c.listen.bind(c))})}}(jQuery);